import 'package:flutter/material.dart';

class DAButton extends StatelessWidget {
  const DAButton({
    super.key,
    required this.label,
    this.onPressed,
    this.icon,
    this.height = 52,
    this.expand = true,
    this.variant = DAButtonVariant.primary,
  });

  final String label;
  final VoidCallback? onPressed;
  final IconData? icon;
  final double height;
  final bool expand;
  final DAButtonVariant variant;

  @override
  Widget build(BuildContext context) {
    final radius = BorderRadius.circular(height / 2);

    final LinearGradient bg = switch (variant) {
      DAButtonVariant.primary => const LinearGradient(
        begin: Alignment.topLeft,
        end: Alignment.bottomRight,
        colors: [Color(0xFFFF7A00), Color(0xFFFFB15A)],
      ),
      DAButtonVariant.secondary => const LinearGradient(
        begin: Alignment.topLeft,
        end: Alignment.bottomRight,
        colors: [Color(0xFF2B2B2B), Color(0xFF121212)],
      ),
    };

    final surface = Ink(
      height: height,
      decoration: BoxDecoration(
        borderRadius: radius,
        gradient: bg,
        boxShadow: const [
          BoxShadow(blurRadius: 20, spreadRadius: -4, offset: Offset(0, 10), color: Colors.black54),
          BoxShadow(blurRadius: 3, offset: Offset(0, 1), color: Color(0x40FFFFFF)),
        ],
      ),
      child: Stack(
        fit: StackFit.expand,
        children: [
          // gloss
          Positioned.fill(
            child: ClipRRect(
              borderRadius: radius,
              child: CustomPaint(painter: _GlossPainter()),
            ),
          ),
          // crisp outline
          Positioned.fill(
            child: IgnorePointer(
              child: DecoratedBox(
                decoration: BoxDecoration(
                  borderRadius: radius,
                  border: Border.all(width: 1.1, color: const Color(0xFFFFC27A)),
                ),
              ),
            ),
          ),
          // content
          Center(
            child: Row(
              mainAxisSize: MainAxisSize.min,
              children: [
                if (icon != null) ...[
                  Icon(icon, size: 18, color: Colors.white),
                  const SizedBox(width: 8),
                ],
                Text(
                  label,
                  style: const TextStyle(
                    color: Colors.white,
                    fontWeight: FontWeight.w700,
                    fontSize: 16,
                    letterSpacing: .2,
                  ),
                ),
              ],
            ),
          ),
        ],
      ),
    );

    final btn = Material(
      color: Colors.transparent,
      child: InkWell(
        onTap: onPressed,
        borderRadius: radius,
        child: ClipRRect(
          borderRadius: radius,
          clipBehavior: Clip.antiAlias, // hard clip, no white edges
          child: surface,
        ),
      ),
    );

    return expand
        ? ConstrainedBox(constraints: BoxConstraints.tightFor(height: height), child: btn)
        : SizedBox(height: height, child: btn);
  }
}

enum DAButtonVariant { primary, secondary }

// Keep your old name working if you previously used DABtn
typedef DABtn = DAButton;

class _GlossPainter extends CustomPainter {
  @override
  void paint(Canvas canvas, Size size) {
    final r = RRect.fromRectAndRadius(Offset.zero & size, Radius.circular(size.height / 2));
    final rect = r.outerRect;
    final path = Path()..addRRect(r);

    // top gloss
    final top = Paint()
      ..shader = const LinearGradient(
        begin: Alignment.topCenter,
        end: Alignment(0, .6),
        colors: [Color(0xA0FFFFFF), Color(0x00FFFFFF)],
      ).createShader(rect);
    canvas.save();
    canvas.clipPath(path);
    canvas.drawRect(Rect.fromLTWH(rect.left, rect.top, rect.width, rect.height * .60), top);
    canvas.restore();

    // bottom depth
    final base = Paint()
      ..shader = const LinearGradient(
        begin: Alignment(0, .5),
        end: Alignment.bottomCenter,
        colors: [Color(0x00000000), Color(0x22000000)],
      ).createShader(rect);
    canvas.save();
    canvas.clipPath(path);
    canvas.drawRect(Rect.fromLTWH(rect.left, rect.height * .55, rect.width, rect.height * .45), base);
    canvas.restore();
  }

  @override
  bool shouldRepaint(covariant CustomPainter oldDelegate) => false;
}
